# Chapter 16: Modifying Existing Code (기존 코드 수정하기)

## 핵심 질문

기존 코드를 수정할 때, 설계를 유지하거나 개선하려면 어떤 원칙을 따라야 하는가?

---

## 1. 소프트웨어 개발은 대부분 수정이다

대부분의 개발 시간은 새 코드를 쓰는 것이 아니라 **기존 코드를 수정**하는 데 쓰인다. 따라서 코드 수정 시의 태도가 시스템의 장기적 품질을 결정한다.

---

## 2. 전략적으로 수정하라

### 2.1 캠핑 규칙

> **코드를 발견했을 때보다 더 나은 상태로 남겨라.**

기능을 추가하거나 버그를 수정할 때, 주변 코드에 설계 문제가 보이면 함께 개선한다.

### 2.2 전술적 수정의 유혹

```python
# 전술적 수정: 최소한의 변경 (나쁜)
def process_order(order):
    # 기존 코드...
    if order.type == "express":
        # 급한 거니까 여기에 바로 추가
        handle_express(order)
        return
    # 기존 코드 계속...

# 전략적 수정: 설계를 개선하면서 변경 (좋은)
def process_order(order):
    handler = ORDER_HANDLERS.get(order.type, default_handler)
    handler.process(order)
```

전술적 수정을 반복하면 코드에 특수 케이스가 쌓이고, 시스템은 점점 복잡해진다.

---

## 3. 주석을 함께 업데이트하라

코드를 수정할 때 **가장 흔한 실수**는 코드만 바꾸고 주석은 그대로 두는 것이다.

- 메서드의 동작이 변경되면 → 인터페이스 주석 업데이트
- 변수의 의미가 바뀌면 → 변수 주석 업데이트
- 새로운 제약 조건이 생기면 → 해당 주석에 반영
- 코드 리뷰에서 주석의 정확성도 확인

> **핵심 통찰**: 코드 변경에서 주석 업데이트를 빼먹는 것이 "주석이 구식이 된다"의 가장 큰 원인이다. 주석 업데이트를 코드 변경의 일부로 취급하라.

---

## 4. 설계 일관성 유지

새 코드를 추가할 때는 기존 설계 패턴에 맞춰야 한다. 기존 설계가 새 코드를 깔끔하게 수용하지 못한다면, **설계를 먼저 개선**한 후 새 코드를 추가하는 것을 고려한다.

```java
// 나쁜: 기존 설계에 억지로 끼워 맞추기
class PaymentProcessor {
    void process(Payment p) {
        if (p.type == CREDIT_CARD) { ... }
        else if (p.type == BANK_TRANSFER) { ... }
        else if (p.type == CRYPTO) {  // 새로 추가 — if 체인이 길어짐
            ...
        }
    }
}

// 좋은: 설계를 개선하여 새 코드를 자연스럽게 수용
interface PaymentHandler {
    void process(Payment p);
}

Map<PaymentType, PaymentHandler> handlers = Map.of(
    CREDIT_CARD, new CreditCardHandler(),
    BANK_TRANSFER, new BankTransferHandler(),
    CRYPTO, new CryptoHandler()  // 새 핸들러를 추가하기만 하면 됨
);
```

---

## 5. 변경 후 점검

변경을 완료한 후 스스로 점검:

- 변경 후의 설계가 **여전히 깔끔한가?**
- 특수 케이스가 추가되지 않았는가?
- 주석이 최신 상태인가?
- 코드를 처음 보는 사람이 이해할 수 있는가?

---

## 요약

- 소프트웨어 개발의 대부분은 **기존 코드 수정**이다.
- **캠핑 규칙**: 코드를 발견했을 때보다 더 나은 상태로 남겨라.
- 전술적으로 최소 변경만 하면 특수 케이스가 축적되어 복잡해진다.
- 코드를 수정할 때 **주석도 반드시 함께 업데이트**하라.
- 기존 설계가 새 코드를 수용하지 못하면, **설계를 먼저 개선**하라.

---

## 다음 챕터와의 연결

Chapter 17 **"Consistency (일관성)"** 에서는 코드베이스 전체에서 일관성을 유지하는 것이 왜 중요한지, 그리고 일관성을 확보하는 구체적 방법을 다룬다.
